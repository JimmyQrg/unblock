<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>SCHOOL CHROMEBOOK UNBLOCKER</title>
<link href="https://fonts.googleapis.com/css2?family=Josefin+Sans:wght@400;600&display=swap" rel="stylesheet">
<style>
  body {
    margin: 0;
    height: 100vh;
    background: url('c6e66984-1a96-4753-b83d-e7824f7c7c2a.png') no-repeat center center fixed;
    background-size: cover;
    font-family: 'Josefin Sans', sans-serif;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    color: white;
    text-shadow: 0 2px 6px rgba(0,0,0,0.7);
  }

  h1 {
    font-size: 2em;
    margin-bottom: 20px;
    letter-spacing: 2px;
    font-weight: 600;
  }

  .box {
    background: transparent;
    border: 5px solid white;
    padding: 25px 35px;
    text-align: center;
    border-radius: 0;
  }

  input {
    padding: 12px;
    font-size: 16px;
    width: 320px;
    margin: 10px 0;
    border: 4px solid white;
    border-radius: 0;
    outline: none;
    background: transparent;
    color: white;
    font-family: 'Josefin Sans', sans-serif;
  }
  input::placeholder {
    color: rgba(255,255,255,0.6);
  }
  input:focus {
    border-color: #00bfff;
    box-shadow: 0 0 12px rgba(0,191,255,0.8);
  }

  button {
    padding: 12px 20px;
    font-size: 16px;
    background: transparent;
    color: white;
    border: 4px solid white;
    border-radius: 12px;
    cursor: pointer;
    font-family: 'Josefin Sans', sans-serif;
    transition: all 0.3s;
  }
  button:hover {
    background: rgba(255,255,255,0.1);
  }
</style>
</head>
<body>
  <h1>SCHOOL CHROMEBOOK UNBLOCKER</h1>
  <div class="box">
    <p>Enter a link below:</p>
    <input type="text" id="url" placeholder="https://example.com">
    <br>
    <button onclick="openBlank()">Apply</button>
  </div>

<script>
function normalizeUrl(raw) {
  if (!raw) return "";
  // If user didn't type http:// or https://, add https:// automatically
  if (!/^https?:\/\//i.test(raw)) {
    return "https://" + raw;
  }
  return raw;
}

async function openBlank() {
  let raw = document.getElementById("url").value.trim();
  if (!raw) return;

  const url = normalizeUrl(raw);

  const newWin = window.open("about:blank", "_blank");
  if (!newWin) {
    alert("Popup blocked! Please allow popups.");
    return;
  }

  // try iframe first (if site allows embedding)
  try {
    newWin.document.write(`
      <!DOCTYPE html>
      <html>
      <head><title>Loaded Content</title></head>
      <body style="margin:0;padding:0;">
        <iframe src="${url}" style="border:none;width:100vw;height:100vh;"></iframe>
      </body>
      </html>
    `);
    newWin.document.close();
  } catch (e) {
    console.warn("iframe failed", e);
  }

  // fallback: fetch + inject
  try {
    const response = await fetch(url);
    const text = await response.text();

    newWin.document.open();
    newWin.document.write(text);

    // link hijacker
    newWin.document.write(`
      <script>
      document.addEventListener("click", function(e) {
        let target = e.target.closest("a");
        if (target && target.href) {
          e.preventDefault();
          window.opener.postMessage({ type: "openLink", url: target.href }, "*");
        }
      });
      <\/script>
    `);

    newWin.document.close();
  } catch (e) {
    console.error("fetch failed:", e);
    newWin.document.body.innerHTML = `<h3 style="color:red;">Could not load this link.</h3>`;
  }
}

// handle child requests to open links
window.addEventListener("message", (event) => {
  if (event.data?.type === "openLink" && event.data.url) {
    openLinkAboutBlank(event.data.url);
  }
});

async function openLinkAboutBlank(url) {
  url = normalizeUrl(url);

  const newWin = window.open("about:blank", "_blank");
  if (!newWin) return;

  try {
    const response = await fetch(url);
    const text = await response.text();

    newWin.document.open();
    newWin.document.write(text);

    // re-attach link hijacker
    newWin.document.write(`
      <script>
      document.addEventListener("click", function(e) {
        let target = e.target.closest("a");
        if (target && target.href) {
          e.preventDefault();
          window.opener.postMessage({ type: "openLink", url: target.href }, "*");
        }
      });
      <\/script>
    `);

    newWin.document.close();
  } catch (e) {
    newWin.document.body.innerHTML = `<h3 style="color:red;">Could not load this link.</h3>`;
  }
}
</script>
</body>
</html>
